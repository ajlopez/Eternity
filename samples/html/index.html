<html>
<head>
<title>Eternity II Browser Sample</title>
<script src="simpleboard.js"></script>
<script src="../../lib/eternity.js"></script>
</head>
<body>
<h1>Eternity II Browser Sample</h1>
<div>
<canvas id="mycanvas" width="500" height="500"/>
</div>
<script>

function getRandomColor() {
    return Math.floor(Math.random() * 256);
}

var ncolors = 20;
var colors = [];

function generateColors(colors, ncolors) {
    colors[0] = [128+64+32, 128+64+32, 128+64+32];
	
	for (var k = 1; k <= ncolors; k++) 
		colors[k] = [ getRandomColor(), getRandomColor(), getRandomColor() ];
}

function drawCell(ctx, x, y, width, height, piece) {
    var color = colors[piece[0]];
    ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';
    
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + width / 2, y + height / 2);
    ctx.lineTo(x, y + height);
    ctx.fill();

    color = colors[piece[1]];
    ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';
    
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + width / 2, y + height / 2);
    ctx.lineTo(x + width, y);
    ctx.fill();

    color = colors[piece[2]];
    ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';
    
    ctx.beginPath();
    ctx.moveTo(x + width, y);
    ctx.lineTo(x + width / 2, y + height / 2);
    ctx.lineTo(x + width, y + height);
    ctx.fill();

    color = colors[piece[3]];
    ctx.fillStyle = 'rgb(' + color[0] + ',' + color[1] + ',' + color[2] + ')';
    
    ctx.beginPath();
    ctx.moveTo(x, y + height);
    ctx.lineTo(x + width / 2, y + height / 2);
    ctx.lineTo(x + width, y + height);
    ctx.fill();
}

generateColors(colors, ncolors);
var puzzle = eternity.createPuzzle();
var width = puzzle.getWidth();
var height = puzzle.getHeight();
puzzle.generate(ncolors);

var canvas = document.getElementById("mycanvas");
var cwidth = canvas.width;
var cheight = canvas.height;
var ctx = canvas.getContext("2d");

var dwidth = cwidth / width;
var dheight = cheight / height;

var dwidth = Math.min(dwidth, dheight);
var dheight = dwidth;

var positions = puzzle.getPiecePositions();
var npositions = positions.length;

for (var k = 0; k < npositions; k++) {
    var position = positions[k];
    drawCell(ctx, position.x * dwidth, position.y * dheight, dwidth, dheight, position.content);
}

</script>

</body>
</html>